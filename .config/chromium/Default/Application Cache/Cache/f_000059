var MsPortalFx;(function(n){var t;(function(t){var i;(function(t){var i;(function(i){"use strict";function e(n){return typeof n=="function"}var l=n.Base,at=n.Data,s=n.Helpers,b=n.ViewModels,k=n.Services.Gallery,o=FxImpl.ProvisioningTelemetry,d=n.getUniqueId,u=ko.observable,g=ko.toJS,vt=new l.Diagnostics.Log("MsPortalFx/ViewModels/ParameterCollectionV2/Internal/ParameterCollectorImpl"),a="enableProvisioning",nt=k.Constants,v=nt.GalleryOptionsKey,yt=nt.GalleryParametersKey,pt=l.Constants.ExtensionNames.Hubs,y=new l.Diagnostics.Log("MsPortalFx/ViewModels/ParameterCollectionV2/Internal/ProvisionerImpl"),tt="masterIsProvisioningPart",h="parameterCollection",it="preserveJourney",wt="previousOutputParameters",bt=new l.Diagnostics.Log("MsPortalFx/ViewModels/ParameterCollectionV2/Internal/ParameterProviderImpl"),rt="provisionOnStartboardPart",f="",kt={lifetimeManagerMissing:f,inputsMissing:f,overrideInputParametersMissing:f,dataModelTypeNotRegistered:f,provisionerMissing:f,provBindingInternalsMissing:
f,provisioningEntityDisabled:f,insufficientInformation:f,provisionerBindingMissing:f,editScopeImplMissing:f,collectorCallbacksMissing:f,providerAlreadyRegistered:f,noCallbacks:f,overrideOutputParametersRejected:f,optionsMissing:f,privateFpTcBIMissing:f,privatePcPrBIMissing:f},r=FxImpl.getErrorMap(kt),dt=(function(){function n(){}return n.createEditScope=function(n,t,i,r){return new p(n,t,i,r)},n})(),p,ut,ft,et,w,ot,st,ht,ct,lt,c;i.EditScopeFactory=dt;p=(function(){function n(n,t,i,u){this._editScopeCache=null;this._editScopeView=null;this._editScopeFetchPromise=null;this._haveEditScopeIdPromise=null;this._editScopeId=null;this._initializeMethod=null;this._lifetimeManager=null;this._providerRole=null;this._stubDataModel=null;t||r.lifetimeManagerMissing();this._providerRole=n;this._lifetimeManager=t;u&&(this._editScopeView=u);this._initializeMethod=i}return Object.defineProperty(n.prototype,"editScope",{get:function(){return this._getEditScopeView().editScope},enumerable:!0,configurable:!0}),
Object.defineProperty(n.prototype,"dataModel",{get:function(){var r=this._getEditScopeView().editScope(),n,i;return!!this._editScopeId&&r?r.root:(n=this.collectorInputs,i=n&&n.inputParameters,i)?(this._stubDataModel||(this._stubDataModel=t.Utilities.parametersToModel(i)),this._stubDataModel):null},enumerable:!0,configurable:!0}),n.prototype.processInputs=function(n){this._editScopeId=n.editScopeId;var t=n.privateFcTpBI,i=t&&t.inputs;return i&&(this.collectorInputs=JSON.parse(JSON.stringify(i))),this._haveEditScopeIdPromise&&this._editScopeId&&this._haveEditScopeIdPromise.resolve(),null},n.prototype.initializeEditScope=function(){this._getEditScopeView()},n.prototype.fetchEditScope=function(){var n=this;return this._editScopeFetchPromise||(this._editScopeFetchPromise=Q(!0).then((function(){return n._editScopeId||(n._haveEditScopeIdPromise=Q.defer()),n._haveEditScopeIdPromise})).then((function(){return n._editScopeView.fetchForExistingData(n._editScopeId,n.collectorInputs)})).then((function()
{return e(n._initializeMethod)&&n._initializeMethod()}))),this._editScopeFetchPromise},n.prototype.initializeDataModel=function(n,t){var e=this,i,u,f;return n||r.inputsMissing(),t||r.overrideInputParametersMissing(),i=s.Deferred(),u=function(t){var r=e._createEditScopeModelFromInputs(t,n.inputMetadata);i.resolve(r)},t?(f=t(n.inputParameters,n.inputMetadata,n.options),f?f.then((function(n){e.collectorInputs=n;u(n.inputParameters)}),(function(){i.reject()})):u(n.inputParameters)):u(n.inputParameters),i.promise()},n.prototype.discardEditScopeEdits=function(){var n=this._editScopeCache;n&&n.disposeAndDiscardEdits(this._editScopeId,this._editScopeView)},n.prototype._getEditScopeCache=function(){var i=this,n,t;return this._editScopeCache||(n=this._providerRole,t=n&&n.dataModelTypeName,!t||at.Metadata.getTypeMetadata(t)||r.dataModelTypeNotRegistered(t),this._editScopeCache=new FxImpl.Data.EditScopeCacheOld({entityTypeName:t,supplyExistingData:function(t){return i.initializeDataModel(t,(function(){return n&&
e(n.overrideInputParameters)?n.overrideInputParameters(t.inputParameters,t.inputMetadata,t.options):s.resolve(t)}))},serializeParams:function(){return"#"}}),this._lifetimeManager.registerForDispose(this._editScopeCache)),this._editScopeCache},n.prototype._getEditScopeView=function(){return this._editScopeView||(this._editScopeView=this._getEditScopeCache().createView(this._lifetimeManager)),this._editScopeView},n.prototype._createEditScopeModelFromInputs=function(n,t){var f={},i,r,e;for(i in n){f[i]={};for(r in n[i])e=n&&n[i]&&n[i][r]||t&&t[i]&&t[i][r]&&t[i][r].defaultValue||"",f[i][r]=u(e)}return f},n})();p=__decorate([n.Composition.ProxyCompatibilityMode],p);ut=(function(){function n(){this.inputs=u();this.errors=u([])}return n})();i.CollectorBindingInternals=ut;ft=(function(){function n(){this.outputs=u();this.commit=u()}return n})();i.ProviderBindingInternals=ft;et=(function(){function n(){this.triggerProvisioningCommand=u();this.provisioningPartExtensionName=u();this.provisioningPartName=
u();this.triggerProvisioningInStartboardPart=u();this.masterIsProvisioningPart=u(!1);this.forceDiscardJourney=u(!0);this.provisioningCommand=u();this.provisioningAttempted=u();this.provisioningStarted=u();this.provisioningCompleted=u()}return n})();i.ProvisionerBindingInternals=et;w=(function(){function n(){}return n.createParameterCollector=function(n,t,i,r,u){return new ot(n,t,i,r,u)},n})();w.confirmCommitSuffix="{0}_confirmCommit";w.tryCommitSuffix="_tryCommit";i.ParameterCollectorFactory=w;ot=(function(){function t(n,t,i,f,e){this._providerCallbacks={};this._collectorRole=null;this._editScopeImpl=null;this._lifetimeManager=null;this._options=null;this._privateFcTpBI=null;this._providerCommitSignal=null;this._commitSignalReceived=!1;this._providerOutputsCache=null;i||r.provisionerBindingMissing();t||r.editScopeImplMissing();f||r.lifetimeManagerMissing();this._collectorRole=n;this._privateFcTpBI=i;this._editScopeImpl=t;this._lifetimeManager=f;this._options=e||{commitWhenSignaled:!1,commitAction:
null};this._providerCommitSignal=u();this._providerOutputsCache={}}return t.prototype.processInputs=function(t){var i,r;return t.privateFpTcBI&&(i=t.privateFpTcBI.commit),t.fromProviderBindingInternals&&(i=t.fromProviderBindingInternals.commit),!i||i===this._providerCommitSignal()||(r=b.ParameterCollectionV2.Internal.ParameterCollectorFactory.confirmCommitSuffix,i===r.format(this._providerCommitSignal())?this._deferredProviderDismiss&&(this._deferredProviderDismiss.resolve(),this._deferredProviderDismiss=undefined,this._commitSignalReceived=!1):(this.providerOutputs=t.privateFpTcBI&&t.privateFpTcBI.outputs||t.fromProviderBindingInternals&&t.fromProviderBindingInternals.outputs,this._commitSignalReceived=!0,this._providerCommitSignal(i),this._options.commitWhenSignaled&&this.commitProviderOutputs(null).then(this._options.commitAction))),n.Helpers.resolve()},t.prototype.addProvider=function(n,t){t||r.collectorCallbacksMissing();this._providerCallbacks[n]&&r.providerAlreadyRegistered(n);this.
_providerCallbacks[n]=t},t.prototype.removeProvider=function(n){this._providerCallbacks[n]&&delete this._providerCallbacks[n]},t.prototype.sendInputsToProvider=function(n){var t;this._providerCallbacks[n]&&e(this._providerCallbacks[n].createInputParameters)?t=this._providerCallbacks[n].createInputParameters():this._collectorRole?t=this._collectorRole.createInputParameters(n):r.noCallbacks(n);n in this._providerOutputsCache&&(h in t.options||(t.options[h]={}),t.options[h][wt]=this._providerOutputsCache[n]);this._privateFcTpBI.inputs(t)},t.prototype.commitProviderOutputs=function(n){var t=this,i=Q.defer(),r,f=b.ParameterCollectionV2.Internal.ParameterCollectorFactory.tryCommitSuffix,u=function(){t._commitSignalReceived=!1;t._providerOutputsCache[n]=t.providerOutputs;t._validateProviderOutputs(n).then((function(){return t._saveProviderOutputs(n)})).then((function(){t._providerCommitSignal().indexOf(f)>-1?(t._deferredProviderDismiss=i,t._privateFcTpBI.errors([{errorMessage:null,parameterName:
t._providerCommitSignal()}]),t._privateFcTpBI.errors([])):i.resolve()})).catch((function(n){i.reject(n)}));r&&r.dispose()};return this._commitSignalReceived?u():r=this._providerCommitSignal.subscribe(this._lifetimeManager,(function(){u()})),i.promise},t.prototype._validateProviderOutputs=function(n){var r=this,t,u=this._providerCallbacks[n],f=u&&u.validateOutputParameters,o=this.providerOutputs.outputParameters,i=this._collectorRole;return e(f)?t=f(o):i&&e(i.validateOutputParameters)&&(t=i.validateOutputParameters(n,o)),Q(t).then((function(t){if(t&&t.length>0)return r._privateFcTpBI.errors(t),r._privateFcTpBI.errors([]),FxImpl.QReject("Validation End with validation Errors",{data:{id:n,validationErrors:t}})}),(function(t){var i=FxImpl.createError("A rejected promise was returned by the 'validateOutputParameters' method.Resolve with the validation errors instead.",{data:{id:n},innerErrors:t});return vt.error(i),Q.reject(i)}))},t.prototype._saveProviderOutputs=function(t){var i=this;return n.tryImmediateResolve(
Q(t),(function(n){var t,u=i._providerCallbacks[n],f=u&&u.saveOutputParameters,o=i.providerOutputs.outputParameters;return e(f)?t=f(o):i._collectorRole?t=i._collectorRole.saveOutputParameters(n,o):r.noCallbacks(n),t?Q(t):void 0}))},t})();st=(function(){function n(){}return n.createParameterProvider=function(n,t){return new ht(n,t)},n})();i.ParameterProviderFactory=st;ht=(function(){function i(n,t){this._editScopeImpl=null;this._providerRole=null;this._lastCommitSignal="";t||r.lifetimeManagerMissing();this._providerRole=n;this._editScopeImpl=t}return i.prototype.processInputs=function(n){var u=null,t,i,f,r;return n.privateFcTpBI&&(t=n.privateFcTpBI.errors,t&&t.length>0&&(i=this._lastCommitSignal,f=t.first((function(n){return n.parameterName===i})),t.length===1&&f&&(r=this._lastDiscardEdits,r&&(r(),this._lastDiscardEdits=undefined),this._privateFpTcBI.commit(i+"_confirmCommit"))),u=this._editScopeImpl.fetchEditScope()),u},i.prototype.getOutputsToCommit=function(){var o=t.Utilities.modelToParameters(
this._editScopeImpl.dataModel),u=this._providerRole,i=u&&u.overrideOutputParameters,f;return e(i)?(i=i.bind(u),f=Q.defer(),i(o).then((function(n){f.resolve({outputParameters:n})}),(function(){r.overrideOutputParametersRejected()})),f.promise):n.Helpers.resolve({outputParameters:o})},i.prototype.commitOutputs=function(n){var i=this,f,e,s;n||r.optionsMissing();n.privateFpTcBI||r.privateFpTcBIMissing();var t=n.provisioner,u=t&&t.provisionOnStartboardPart,o=t&&t.enableProvisioning();o&&u&&!u()&&!n.privatePcPrBI&&r.privatePcPrBIMissing();f=function(){var r=n.privateFpTcBI;i._lastCommitSignal=d()+"_tryCommit";i._lastDiscardEdits=n.discardEdits;i._privateFpTcBI=r;r.commit(undefined);r.outputs(t&&t.mappedOutputs||n.provisionerData);r.commit(i._lastCommitSignal);o&&u&&!u()&&n.privatePcPrBI.provisioningAttempted({commitId:d()})};o?(e=t.executeProvisioning(n.provisionerData,this._editScopeImpl.collectorInputs.options),s=n.progressAction,s&&s(e),e?e.then((function(){f()}),(function(){bt.error("Provisioning action failed.")})
):f()):f()},i})();ct=(function(){function n(){}return n.createProvisioner=function(n,t){return new lt(n,t)},n})();i.ProvisionerFactory=ct;lt=(function(){function t(t,i){var f=this,e;this.enableProvisioning=u(!1);this.provisionOnStartboardPart=u(!0);this._data=null;this._executionDeferred=null;this._options=null;this._privatePcPrBI=null;this._provisionerRole=null;t||r.provisionerMissing();i||r.provBindingInternalsMissing();this._lifetimeManager=new FxImpl.TriggerableLifetimeManager;this._provisionerRole=t;this._privatePcPrBI=i;e=this._executionDeferred=s.Deferred();Q(e.promise()).finally((function(){var n=f._lifetimeManager;n&&(n.dispose(),f._lifetimeManager=null)})).catch(n.noop)}return t.prototype.processInputs=function(n){var r,i,t;return this.provisionOnStartboardPart(n.provisionOnStartboardPart),this._privatePcPrBI.masterIsProvisioningPart(n.masterIsProvisioningPart),r=n.privateFcTpBI,i=r&&r.inputs,i&&(h in i.options&&i.options[h]&&(t=i.options[h],a in t&&t[a]&&this.enableProvisioning(!0),
rt in t?this.provisionOnStartboardPart(t[rt]):this.provisionOnStartboardPart(n.provisionOnStartboardPart),tt in t?this._privatePcPrBI.masterIsProvisioningPart(t[tt]):this._privatePcPrBI.masterIsProvisioningPart(n.masterIsProvisioningPart),it in t&&this._privatePcPrBI.forceDiscardJourney(!t[it])),a in i.options&&i.options[a]&&this.enableProvisioning(!0)),null},t.prototype.executeProvisioning=function(n,t){var i=this,o,nt,f,a,u;this.enableProvisioning()||r.provisioningEntityDisabled();var h=this._provisionerRole,p=n,w=e(h.executeCustomProvisioning),b=e(h.mapOutputsForProvisioning);if(w&&b)return f=FxImpl.createError("You can only override 'executeCustomProvisioning' or 'mapOutputsForProvisioning', but not both."),y.error(f),s.reject(f);if(w)return this._traceProvisioningStarted(),o=h.executeCustomProvisioning(n.outputParameters,t),o?o.then((function(){i._traceProvisioningEnded(!0)}),(function(){i._traceProvisioningEnded(!1)})):this._traceProvisioningEnded(undefined),o;var d=t&&t[v],c=d&&d.galleryItem,
l=c&&c.categoryIds;return l&&l.length>0&&(nt=l.some((function(n){return n.toLowerCase()===k.noSubCreateCategoryId})),nt)?(f=FxImpl.createError("No custom provisioning is implemented. The gallery item '"+c.itemDisplayName+"' requires no subscriptions, which requires custom provisioning. You need to override 'executeCustomProvisioning'"),y.error(f),s.reject(f)):b?(a=this._provisionerRole.mapOutputsForProvisioning(p.outputParameters,t),u=s.Deferred(),a?a.then((function(r){if(n.outputParameters=r,i.provisionOnStartboardPart()){if(!i._privatePcPrBI.masterIsProvisioningPart()){i._initializeProvisioningEntity(t[v]);var f={provisioningOptions:{originalData:p,data:g(n),options:g(t)}};i._privatePcPrBI.triggerProvisioningInStartboardPart(f)}u.resolve()}else i._beginExecution(n,t).then((function(){u.resolve()}),(function(){u.reject()}))}),(function(){y.error("The promise returned by 'mapOutputsForProvisioning' should not be rejected.");u.reject()})):(y.error("'mapOutputsForProvisioning' did not return a promise."),
u.reject()),u.promise()):this._beginExecution(n,t)},t.prototype._initializeProvisioningEntity=function(n){var t=n.uiDefinition.markup.reference,i=t.provisioningPartName,u=t.provisioningPartExtension;i||u?t.provisioningPartName&&t.provisioningPartExtension||r.insufficientInformation():(i="ProvisionerPart",u=pt);this._privatePcPrBI.provisioningPartName(i);this._privatePcPrBI.provisioningPartExtensionName(u)},t.prototype._beginExecution=function(t,i){var u=this,r;return this._data=t,this._options=i,r=this._lifetimeManager,r?(this._privatePcPrBI.provisioningCommand.fxOnce(r,(function(n){n.status(c.Idle);u._executeProvisioning(n)})),this._privatePcPrBI.triggerProvisioningCommand(n.getUniqueId()),this._executionDeferred.promise()):s.reject(FxImpl.createError("This ProvisionerV2 object is already disposed."))},t.prototype._executeProvisioning=function(n){var t=this,i;n.status(c.InProgress);this._traceProvisioningStarted();i=n.execute({options:this._options,data:this._data});i?i.then((function(i)
{t.deploymentResponse=i;t._privatePcPrBI.provisioningStarted({galleryParameters:t._data.outputParameters[yt],configurationOptions:t._options[v],deploymentResponse:i});n.status(c.Succeeded);t._traceProvisioningEnded(!0);t._executionDeferred.resolve()}),(function(){n.status(c.Failed);t._traceProvisioningEnded(!1);t._executionDeferred.reject()})):(this._traceProvisioningEnded(undefined),this._executionDeferred.resolve())},t.prototype._createEventBase=function(){var i=this._options&&this._options[v],n=i&&i.launchingContext,t={name:undefined,data:{oldCreateApi:!0}};return n&&(t.name=n.galleryItemId,t.data.launchingContext=n),t},t.prototype._traceProvisioningStarted=function(){return o.traceProvisioningStarted(this._createEventBase())},t.prototype._traceProvisioningEnded=function(n){var r=this._createEventBase(),t,i;return n===undefined?(t=o.ActionModifier.Succeeded,i=o.ProvisioningStatus.NoPromise):n?(t=o.ActionModifier.Succeeded,i=o.ProvisioningStatus.Resolved):(t=o.ActionModifier.Failed,i=o.
ProvisioningStatus.UnknownFailure),r.actionModifier=t,r.data.provisioningStatus=i,o.traceProvisioningEnded(r)},t})(),(function(n){n[n.Idle=0]="Idle";n[n.InProgress=1]="InProgress";n[n.Succeeded=2]="Succeeded";n[n.Failed=3]="Failed"})(c=i.ProvisioningCommandStatus||(i.ProvisioningCommandStatus={}))})(i=t.Internal||(t.Internal={}))})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(t){var i;(function(t){"use strict";var e=n.Base,u=n.Helpers,o=ko.observable,f=n.getUniqueId,s=new e.Diagnostics.Log("MsPortalFx/ViewModels/ParameterCollection/ParameterProvider"),i="",h={collectorInputsMissing:i,editScopeIdMissing:i,editScopeViewMissing:i,inputsMissing:i,onInputsReceivedMissing:i,optionsMissing:i,overrideInputParametersMissing:i,privateFpTcBIMissing:i,privatePcPrBIMissing:i,provisionerMissing:i},r=FxImpl.getErrorMap(h),c=(function(){function t(n){n||r.editScopeViewMissing();this.
_editScopeView=n}return t.prototype.fetchEditScope=function(n,t){var i=this;return this._editScopeFetchPromise||(this._editScopeFetchPromise=this._editScopeView.fetchForExistingData(n,t).finally((function(){i._editScopeFetchPromise=undefined}))),this._editScopeFetchPromise},t.prototype.initializeDataModel=function(n,t){n||r.inputsMissing();t||r.overrideInputParametersMissing();var i=u.Deferred();return t(n.inputParameters).then((function(t){var f={},r,u,e;for(r in t){f[r]={};for(u in t[r])e=t&&t[r]&&t[r][u]||n.inputMetadata&&n.inputMetadata[r]&&n.inputMetadata[r][u]&&n.inputMetadata[r][u].defaultValue||"",f[r][u]=o(e)}i.resolve(f)}),(function(){i.reject()})),i.promise()},t.prototype.onCollectorBindingsReceived=function(t,i,f){var o=this;t||r.collectorInputsMissing();i||r.editScopeIdMissing();f||r.onInputsReceivedMissing();var s="enableProvisioning",e=u.Deferred(),h={enableProvisioning:!1,promise:e.promise()},c=t.options;return s in c&&c[s]&&(h.enableProvisioning=!0),this.fetchEditScope(i,t).
then((function(){try{n.deepEquals(o._previousCollectorInputs,t)||(o._previousCollectorInputs=t,o._onInputsReceivedPromise=f(t));var i=o._onInputsReceivedPromise;i?i.then((function(){e.resolve()}),(function(){e.reject()})).finally((function(){o._onInputsReceivedPromise=undefined})):e.resolve()}catch(r){e.reject()}}),(function(){e.reject()})),h},t.prototype.commitProvider=function(n){var t,i,u,e,o;n||r.optionsMissing();n.privateFpTcBI||r.privateFpTcBIMissing();t=n.provisioner;n.enableProvisioning&&!t&&r.provisionerMissing();i=n.enableProvisioning;!i||n.provisionOnStartboardPart||n.privatePcPrBI||r.privatePcPrBIMissing();u=function(){var u=n.privateFpTcBI,r;u.outputs(t&&t.mappedOutputs||n.provisionerData);n.privateFpTcBI.commit(f());i&&!n.provisionOnStartboardPart&&n.privatePcPrBI.provisioningAttempted({commitId:f()});r=n.discardEdits;r&&r()};i?(e=t.executeProvisioning(n.provisionerData,n.provisionerOptions),o=n.progressAction,o&&o(e),e?e.then((function(){u()}),(function(){s.error("Provisioning action has failed.")})
):u()):u()},t})();t.ProviderBase=c})(i=t.Internal||(t.Internal={}))})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";function o(n,t,i){var r=n&&n.stepStatuses,u=r&&r.length?r[0].status:0;return{stepId:"NoWizardStep",status:u,isFirstStep:!0,isLastStep:!0,isOptional:!1,disabled:!1,allowToggleProvisioningLocation:t,masterIsProvisioningPart:i}}var s=n.ViewModels,u=i.Internal,r=ko.observable,f=" is not implemented",e=(function(t){function i(n,i){var f=t.call(this,n)||this;f.parameterCollectionErrors=r();f.privateFcTpBI=new u.CollectorBindingInternals;f.savedState=r();f.currentState=r();f.stepInput=r();f.cloudName=r();f._collectorBase=null;f._container=null;var s=f.currentState,e={stepStatuses:[]},h=i&&i.content,c=h&&h.savedState;return c&&(e=c),s(e),n.selectable.isSelected.subscribe(n,(function(){f.savedState(s())})),f.stepInput(o(e,!1,!0)),f._container=n,f._collectorBase=
new u.CollectorBase(new u.Provisioner(f)),f.privatePcPrBI=new u.ProvisioningEntityBindingInternals,f.enableProvisioning=r(!0),f}return __extends(i,t),i.prototype.onInputsSet=function(t){var r=this,i;this.cloudName(u.getCloudNameFromInputs(t));i=this.getProviderInputs(null);this.privateFcTpBI.inputs(i);this._collectorBase.onProviderBindingInternalsReceived(t.fromProviderBindingInternals,i&&i.options,t.stepOutput,(function(n,t){return r.onProviderCommit(n,t)}),(function(){r._container.selectable.isSelected(!1)}),n.noop)},i.prototype.getProviderInputs=function(){throw new Error("'getProviderInputs'"+f);},i.prototype.onProviderCommit=function(){throw new Error("'onProviderCommit'"+f);},i})(t.OpenBladeCommand);i.BaseCommandViewModel=e})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(t){"use strict";var s=n,r=s.ViewModels,a=r.ActionBars.Base,u=t.Internal,p=r.ParameterCollectionV2.
Internal,c=s.Helpers,f=HubsExtension.Azure.Pricing.Constants,h=s.deepEquals,i=ko.observable,w=ko.observableArray,v=p.ParameterCollectorFactory,b=v.confirmCommitSuffix,k=v.tryCommitSuffix,y=s.forEachKey,e="",d={multipleSelectors:e,getProviderInputs:e,onProviderCommit:e,onInputsReceived:e,onCommitError:e},o=FxImpl.getErrorMap(d),l=(function(n){function e(t,e,o){var s=n.call(this,t)||this,c;s.editScopeId=i();s.actionInProgress=i(!1);s.eula=i("");s.secondaryLinkDisplayText=i("");s.galleryPricingInfo=i();s.cloudName=i();s._providerBase=null;s._actionBarOutput=null;s._actionInProgressLock=!1;s._baseCollectorInputs=null;s._baseFormContainer=null;s._baseProviderCommit=null;s._baseProviderOutputs=null;s._deferredProviderDismiss=null;s._hotSpotItems=w();s._initialSelectedValue=null;s._previousOutput=null;s._provisionerInstance=null;s._savedProviderOutputs=null;s._selectableMap={};s._galleryItem=i(null);s._editScopeCache=null;s._editScopeView=null;c=s._ltm;s._editScopeCache=new FxImpl.Data.EditScopeCacheOld(
{entityTypeName:o,supplyExistingData:function(n){return s._providerBase.initializeDataModel(n,(function(n){return s.overrideInputParameters(n)}))},serializeParams:function(){return"#"}});c.registerForDispose(s._editScopeCache);s._editScopeView=s._editScopeCache.createView(c);s._providerBase=new u.ProviderBase(s._editScopeView);s.privateFcTpBI=new u.CollectorBindingInternals;s.privateFpTcBI=new u.ProviderBindingInternals;s.privatePcPrBI=new u.ProvisioningEntityBindingInternals;s.editScope=s._editScopeView.editScope;s.enableProvisioning=i(!1);s.provisionOnStartboardPart=i(!0);s.parameterCollectionErrors=i();s.stepInput=i();s.stepOutput=i();var l=e&&e.content||{},v=l.selectable||{},y=l.secondaryLinkSelectable||{};return s._initialSelectedValue=v.selectedValue,s.selectable=new r.Selectable({allowUnselect:!1,selectedValue:s._initialSelectedValue,isSelected:v.isSelected,isActivated:v.isActivated}),c.registerForDispose(s.selectable),s.secondaryLinkSelectable=new r.Selectable({allowUnselect:!1,selectedValue:
y.selectedValue,isSelected:y.isSelected,isActivated:y.isActivated}),c.registerForDispose(s.secondaryLinkSelectable),s.hotSpot=new r.SelectableSet(s._hotSpotItems,function(n,t){return n.selectedValue()===t},function(n){return n.selectedValue()},l.hotSpot),c.registerForDispose(s.hotSpot),s._actionBarOutput=i(),s._baseProviderCommit=i(),s._baseFormContainer=t,s._provisionerInstance=new u.Provisioner(s),s._savedProviderOutputs={},s._actionBarOutput.subscribe(c,(function(n){var i,u,t;a.isCompleted(n)&&(i=function(){s.actionInProgress(!0);var n=s.getOutputsToCommit(),t=function(){var n=s._editScopeCache;n.disposeAndDiscardEdits(s.editScopeId(),s._editScopeView)};s._providerBase.commitProvider({enableProvisioning:s.enableProvisioning(),provisioner:s._provisionerInstance,provisionerData:n,provisionerOptions:s._baseCollectorInputs.options,progressAction:function(n){s._baseFormContainer.operations.add(n,{blockUi:!0})},discardEdits:t,privateFpTcBI:s.privateFpTcBI,privatePcPrBI:s.privatePcPrBI,provisionOnStartboardPart:
s.provisionOnStartboardPart()})},n.actionButtonClicked&&s.secondaryLinkSelectable.isSelected()?s.secondaryLinkSelectable.selectedValue().detailBlade===f.LegalTermsBlade.bladeName?(s._actionInProgressLock=!0,s.secondaryLinkSelectable.isSelected(!1),i()):s.secondaryLinkSelectable.isSelected(!1):(u=s.galleryPricingInfo(),t=s._galleryItem(),s.enableProvisioning()&&u&&t&&(t.products.length>0||t.productsWithNoPricing.length>0)?(s.secondaryLinkSelectable.selectedValue(r.getBladeSelection(f.LegalTermsBlade.bladeExtension,f.LegalTermsBlade.bladeName,{galleryPricingInfo:u,galleryItem:t})),s.actionInProgress(!0),s.secondaryLinkSelectable.isSelected(!0)):i()))})),s.selectable.isSelected.subscribe(c,(function(n){n||s._unselectFields()})),s.secondaryLinkSelectable.isSelected.subscribe(c,(function(n){n||s._actionInProgressLock||s.actionInProgress(!1)})),s.selectable.value.subscribe(c,(function(n){s._resetSelectionStateOfSelectors(n)})),s.parameterCollectionErrors.subscribe(c,(function(n){n&&(s.privateFcTpBI.
errors(n),s.privateFcTpBI.errors([]))})),s.stepOutput.subscribe(c,(function(n){var t=s._previousOutput;s._previousOutput=n;!h(t,n)&&a.isCompleted(n)&&s._onSelectorComplete(n.stepId).then((function(){s.selectable.isSelected(!1)}))})),ko.computed(c,(function(){s.galleryPricingInfo()&&s._galleryItem()?s.secondaryLinkDisplayText(f.PricingSummaryBlade.displayText):s.secondaryLinkDisplayText(null)})),s}return __extends(e,n),Object.defineProperty(e.prototype,"dataModel",{get:function(){var n=this.editScope();return n&&n.root},enumerable:!0,configurable:!0}),e.prototype.onInputsSet=function(n){var d=this,p=null,o,i,a,s,c,e,v,y,t,l;if(this.cloudName(u.getCloudNameFromInputs(n)),this.editScopeId(n.editScopeId),this.provisionOnStartboardPart(n.provisionOnStartboardPart),this.privatePcPrBI.masterIsProvisioningPart(n.masterIsProvisioningPart),o=n.privateFcTpBI,o){if(i=o.inputs,i){this._baseCollectorInputs=i;a=this._providerBase.onCollectorBindingsReceived(i,this.editScopeId(),(function(n){return d.onInputsReceived(
n)}));this.enableProvisioning(a.enableProvisioning);p=a.promise;var w=i.options,k=w&&w.galleryOptions,g=k&&k.galleryItem;this._galleryItem(g||null)}if(s=o.errors,s&&s.length>0){this.onCommitError(s);this.onCommitError([])}}return c=n.privateFpTcBI,c&&(e=c.commit,!e||e===this._baseProviderCommit()||(e===b.format(this._baseProviderCommit())?(v=this._deferredProviderDismiss,v&&(v.resolve(),this._deferredProviderDismiss=undefined)):(this._baseProviderOutputs=c.outputs,this._baseProviderCommit(e)))),y=n.stepOutput,y&&this.stepOutput(y),t=n.output,t&&(l=t&&t.secondaryLinkClicked,!l||l!==this.secondaryLinkDisplayText()||this._previousSecondaryLinkCommitId===t.commitId||(this._previousSecondaryLinkCommitId=t.commitId,this.actionInProgress(!1),this.secondaryLinkSelectable.selectedValue(r.getBladeSelection(f.PricingSummaryBlade.bladeExtension,f.PricingSummaryBlade.bladeName,{galleryPricingInfo:this.galleryPricingInfo(),galleryItem:this._galleryItem()})),this.secondaryLinkSelectable.isSelected(!0)),
!t.status||l||h(t,this._actionBarOutput())||this._actionBarOutput(t)),p},e.prototype.registerHotSpot=function(n){var t=n.selectable||n,i;this._hotSpotItems.push(t);i=this.hotSpot.selectableItems().first((function(n){return n.data===t}));ko.utils.twoWayBinding(this._ltm,t.isSelected,i.isActivated)},e.prototype.registerSelector=function(n,t){var r=this,i;this._selectableMap[n]&&o.multipleSelectors();i=t.selectable;this._selectableMap[n]=i;this._initialSelectedValue!==undefined&&h(this._initialSelectedValue,i.selectedValue())&&i.isSelected(this.selectable.isSelected());i.isSelected.subscribe(this._ltm,(function(t){t&&(r._unselectFields(i),r.selectable.selectedValue(i.selectedValue()),r.stepInput({stepId:n,status:0,isLastStep:!1}),r.selectable.isSelected(!0),r._onSelectorLoad(n))}))},e.prototype.overrideInputParameters=function(n){return c.resolve(n)},e.prototype.getProviderInputs=function(){return o.getProviderInputs()},e.prototype.onProviderCommit=function(){return o.onProviderCommit()},e.prototype.
onInputsReceived=function(){return o.onInputsReceived()},e.prototype.getOutputsToCommit=function(){var n=t.Models.modelToParameters(this.dataModel);return{outputParameters:n}},e.prototype.onCommitError=function(){return o.onCommitError()},e.prototype._unselectFields=function(n){y(this._selectableMap,(function(t,i){n&&n===i||i.isSelected(!1)}))},e.prototype._resetSelectionStateOfSelectors=function(n){var t,i;(y(this._selectableMap,(function(r,u){u.isSelected()&&(i=u);h(u.selectedValue(),n)&&(t=u)})),t!==i)&&(i&&i.isSelected(!1),t&&t.isSelected(!0))},e.prototype._onSelectorLoad=function(n){var i=this,t=c.Deferred();return this._providerBase.fetchEditScope(this.editScopeId(),this._baseCollectorInputs).then((function(){var r=i.getProviderInputs(n);i.privateFcTpBI.inputs(r);t.resolve()}),(function(){t.reject()})),t.promise()},e.prototype._onSelectorComplete=function(n){var t=this,i=c.Deferred(),r=this._ltm.createChildLifetime();return this._baseProviderCommit.subscribe(r,(function(){t._savedProviderOutputs[
n]=t._baseProviderOutputs;t.onProviderCommit(n,t._baseProviderOutputs).then((function(n){n?t._baseProviderCommit().indexOf(k)>-1?(t._deferredProviderDismiss=i,t.privateFcTpBI.errors([{errorMessage:null,parameterName:t._baseProviderCommit()}]),t.privateFcTpBI.errors([])):i.resolve():i.reject()}));r.dispose()})),i.promise()},e})(r.Forms.Form.ViewModel);l=__decorate([n.Composition.ProxyCompatibilityMode],l);t.BaseFormViewModel=l})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";var l=n.ViewModels,s=l.Controls,e=s.Lists.Grid,y=l.Forms.Selector.ViewModel,h=i.Internal,a=n.getUniqueId,o="infoBalloon",r=ko.observable,p=ko.observableArray,v=window,u="",w={getMatchingItemIndex:u,getColumns:u,itemMatchesSelection:u,createSelection:u,onProviderCommit:u,onInputsReceived:u,onCommitError:u},f=FxImpl.getErrorMap(w),c=(function(u){function c(i,f,o,s,c){var l,a,y,v,w;return s===
void 0&&(s=!1),c===void 0&&(c=null),l=u.call(this,i)||this,l.editScopeId=r(),l.triggerSelectAction=r(""),l.multiselectEnabled=r(!1),l.valid=r(!1),l.showCreateAction=r(!1),l.eula=r(""),l.filterPickerItemsParameterName="filterPickerItems",l.pickerItemsParameterName="pickerItems",l.listHeader=r(),l.listSubHeader=r(),l.isCreateActionResult=r(!1),l._createActionOutputs=null,l.pickerActivationBladeOpener=r(undefined),l.createActionBladeOpener=r(undefined),l.itemSelectedByDefault=r(),l.filterItems=r(),l._filteredItems=[],l._editScopeCache=null,l._editScopeView=null,l._providerBase=null,l._pickerInputCollections=null,l._createActionProviderCommited=null,l._actionBarOutput=null,l._createSelectorField=null,l._selectorOriginalValue=r(),l._selectorEditableValue=r(),l._createSelectorBladeName=null,l._createSelectorBladeExtension=null,l._throttleUnselectSelectorFieldHandle=null,l.filters=p(),a=l.lifetimeManager,l.controlType=80,l.multiselectEnabled(s),y=l._editScopeCache=new FxImpl.Data.EditScopeCacheOld(
{supplyExistingData:function(n){return l._providerBase.initializeDataModel(n,(function(n){return l.overrideInputParameters(n)}))},serializeParams:function(){return"#"}}),a.registerForDispose(y),l._editScopeView=y.createView(a),l._providerBase=new h.ProviderBase(l._editScopeView),l.privateFcTpBI=new h.CollectorBindingInternals,l.privateFpTcBI=new h.ProviderBindingInternals,l.parameterCollectionErrors=r(),l.stepInput=r(),l.createActionSelectorField=r(),l._createActionProviderCommited=!1,l.isCreateActionResult(!1),l._actionBarOutput=r(),v=e.Extensions.SelectableRow,w=l._getGridExtensionOptions(),c?(v=v|e.Extensions.Pageable,n.extend(w,{pageable:{type:e.PageableType.Sequential,dataNavigator:c}}),l.itemsGridViewModel=new e.ViewModel(a,null,v,w)):l.itemsGridViewModel=new e.ViewModel(a,o,v,w),l.itemsGridViewModel.showHeader=!0,l.itemsGridViewModel.columns=l.getColumns(),a.registerForDispose(l.itemsGridViewModel),l._initializeCreateActionSelector(a),l._actionBarOutput.subscribe(a,(function(n){if(
t.ActionBars.Base.isCompleted(n)){var r=l.getOutputsToCommit(),u=function(){var n=y;n.disposeAndDiscardEdits(l.editScopeId(),l._editScopeView)};setTimeout((function(){l._providerBase.commitProvider({enableProvisioning:!1,provisioner:null,provisionerData:r,provisionerOptions:l._pickerInputCollections.options,progressAction:function(n){i.operations.add(n,{blockUi:!0})},discardEdits:u,privateFpTcBI:l.privateFpTcBI})}),100)}})),l.itemSelectedByDefault.subscribe(a,(function(n){if(l.multiselectEnabled()&&Array.isArray(n))n.forEach((function(n){var t=l.getMatchingItemIndex(n);l._selectGridItem(t)}));else if(n){var t=l.getMatchingItemIndex(n);l._selectGridItem(t)}})),l.filterItems.subscribe(a,(function(n){l._filterGridItems(n)})),l.itemsGridViewModel.items.subscribe(a,(function(n){var t,i;l._filterGridItems(l.filterItems());l._runFilters(n);c&&(t=l.itemSelectedByDefault()||[],t&&Array.isArray(t)?t.forEach((function(n){var t=l.getMatchingItemIndex(n);l._selectGridItem(t)})):t&&(i=l.getMatchingItemIndex(t),
l._selectGridItem(i)))})),l.parameterCollectionErrors.subscribe(a,(function(n){l.privateFcTpBI.errors(n)})),l.itemsGridViewModel.selectableData.selectedItems.subscribe(a,(function(n){l._onSelectedItemsChanged(n)})),l.createActionBladeOpener.subscribe(a,(function(n){n?(l._clearThrottleUnselectSelectorFieldHandle(),l.itemsGridViewModel.selectableData.selectedItems([]),l.createActionSelectorField().selectable.isSelected(!0)):l._closeBlade(l.itemsGridViewModel.selectableData.selectedItems())})),l}return __extends(c,u),c.prototype.initializeCreateSelector=function(n,t,i,r,u){this._selectorOriginalValue(n);this._selectorEditableValue(n);this._createSelectorField.label(t);this._createSelectorBladeName=i;this._createSelectorBladeExtension=r;u&&ko.utils.arrayPushAll(this._createSelectorField.validations,u)},c.prototype.onInputsSet=function(t){var i=this,e=null,o,r,f,u;if(this.editScopeId(t.editScopeId),t&&t.privateFcTpBI&&t.privateFcTpBI.inputs&&(this._pickerInputCollections=t.privateFcTpBI.inputs,this.
stepInput(t.stepInput),o=this._providerBase.onCollectorBindingsReceived(t.privateFcTpBI.inputs,this.editScopeId(),(function(n){return i.onInputsReceived(n)})),e=o.promise),t&&t.privateFcTpBI&&t.privateFcTpBI.errors&&t.privateFcTpBI.errors.length>0)this.onCommitError(t.privateFcTpBI.errors);return r=t.privateFpTcBI,f=r&&r.commit,f&&f!==this._createActionProviderCommited&&(this.onProviderCommit(null,r.outputs).then((function(n){n&&(i.isCreateActionResult(!0),i.createActionSelectorField().selectable.isSelected(!1),i._createActionOutputs=r.outputs,i.itemsGridViewModel.selectableData.selectedItems([]),i.valid(!0),i.triggerSelectAction(a()))})),this._createActionProviderCommited=f),u=t.output,u&&u.status&&!n.deepEquals(u,this._actionBarOutput())&&this._actionBarOutput(u),e},c.prototype.overrideInputParameters=function(t){return n.Helpers.resolve(t)},c.prototype.getParameter=function(n,t,i){return t in i&&n in i[t]?i[t][n]:null},c.prototype.dispose=function(){this._clearThrottleUnselectSelectorFieldHandle(
);u.prototype.dispose.call(this)},Object.defineProperty(c.prototype,"dataModel",{get:function(){var n=this._editScopeView.editScope();if(n&&!n.isDisposed)return n.root},enumerable:!0,configurable:!0}),c.prototype.getMatchingItemIndex=function(){return f.getMatchingItemIndex()},c.prototype.getColumns=function(){return f.getColumns()},c.prototype.itemMatchesSelection=function(){return f.itemMatchesSelection()},c.prototype.createSelection=function(){return f.createSelection()},c.prototype.getProviderInputs=function(){return this._pickerInputCollections},c.prototype.onProviderCommit=function(){return f.onProviderCommit()},c.prototype.onInputsReceived=function(){return f.onInputsReceived()},c.prototype.getOutputsToCommit=function(){var n=i.Models.modelToParameters(this.dataModel);return{outputParameters:n}},c.prototype.onCommitError=function(){f.onCommitError()},c.prototype._onSelectedItemsChanged=function(n){var t=n&&n.length>0,i;if(t){if(this.isCreateActionResult(!1),i=this._runFilters(n),
i){this.valid(!1);return}this._closeBlade(n)}this.valid(t)},c.prototype._findGridMatchItem=function(n){var t=this;return this.itemsGridViewModel.items().first((function(i){return t.itemMatchesSelection(n,i)}))},c.prototype._runFilters=function(n){var t=this,r,i;return!n||n.length<1?!1:(r=!1,i=this.filters&&this.filters(),i&&i.length>0&&i.forEach((function(i){i.getDisabledItems(n).then((function(n){n.forEach((function(n){var i=t._findGridMatchItem(n.item);i&&(t._disableGridItem(i,n.disabledReason),t.itemsGridViewModel.selectableData.selectedItems.remove(i),r=!0,t._filteredItems.push(n))}))}))})),r)},c.prototype._closeBlade=function(n){var t=this,i;this._clearThrottleUnselectSelectorFieldHandle();this._throttleUnselectSelectorFieldHandle=v.setTimeout((function(){t.createActionSelectorField()&&t.createActionSelectorField().selectable.isSelected(!1)}),0);this.multiselectEnabled()||n.length!==1||(i=this.itemSelectedByDefault()&&this.itemMatchesSelection(this.itemsGridViewModel.items()[this.getMatchingItemIndex(
this.itemSelectedByDefault())],n[0]),i||this.triggerSelectAction(a()))},c.prototype._clearThrottleUnselectSelectorFieldHandle=function(){this._throttleUnselectSelectorFieldHandle&&(v.clearTimeout(this._throttleUnselectSelectorFieldHandle),this._throttleUnselectSelectorFieldHandle=null)},c.prototype._getGridExtensionOptions=function(){var n=this;return{selectableRow:{selectionMode:this.multiselectEnabled()?2:1,itemMatchesSelection:function(t,i){return n.itemMatchesSelection(t,i)},createSelection:function(t){return n.createSelection(t)}}}},c.prototype._selectGridItem=function(n){if(n!==-1){var t=this.itemsGridViewModel.getRowMetadata(this.itemsGridViewModel.items()[n]);t.selected(!0)}},c.prototype._disableGridItem=function(n,t){if(n){var i=this.itemsGridViewModel.getRowMetadata(n);i.disabled(!0);i.selected(!1);t&&n.hasOwnProperty(o)&&(n[o]||(n[o]=new s.DockedBalloon.ViewModel(this.lifetimeManager)),n[o].content(t))}},c.prototype._initializeCreateActionSelector=function(n){var t=this;this.
_createSelectorField=new y(n,{defaultValue:this._selectorOriginalValue});this._createSelectorField.value=this._selectorEditableValue;this.createActionSelectorField(this._createSelectorField);this._createSelectorField.selectable.isSelected.subscribe(n,(function(n){n?t._launchCreateActionBlade():t.createActionBladeOpener(undefined)}))},c.prototype._launchCreateActionBlade=function(){var n=this.getProviderInputs(null);this.privateFcTpBI.inputs(n);this.itemsGridViewModel.selectableData.selectedItems([]);this.createActionBladeOpener({detailBlade:this._createSelectorBladeName,extension:this._createSelectorBladeExtension,detailBladeInputs:{}})},c.prototype._filterGridItems=function(n){var t=this,r=this.itemsGridViewModel.items(),i=this._filteredItems;n&&n.forEach((function(n){var i=t.getMatchingItemIndex(n.id);i!==-1&&t._disableGridItem(r[i],n.reason)}));i&&i.length>0&&i.forEach((function(n){var i=t._findGridMatchItem(n.item);i&&t._disableGridItem(i,n.disabledReason)}))},c})(s.Loadable.ViewModel);c=
__decorate([n.Composition.ProxyCompatibilityMode],c);i.BasePickerListViewModel=c})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";var a=n.Base,o=n.Helpers,s=n.ViewModels,c=s.Controls.Wizard,w=s.ActionBars.Base,u=i.Internal,r=ko.observable,f="",v={getProviderInputs:f,onProviderCommit:f,onInputsReceived:f,onCommitError:f},e=FxImpl.getErrorMap(v),l=s.ParameterCollectionV2.Internal.ParameterCollectorFactory,y=l.confirmCommitSuffix,p=l.tryCommitSuffix,h=(function(f){function s(n,i,e){var o=f.call(this,n,i&&i.content)||this,s,h;return o.editScopeId=r(),o.eula=r(""),o.cloudName=r(),o._editScopeCache=null,o._editScopeView=null,o._actionBarOutput=null,o._baseCollectorInputs=null,o._baseProviderCommit=null,o._baseProviderOutputs=null,o._baseWizardContainer=null,o._deferredProviderDismiss=null,o._providerBase=null,o._provisionerInstance=null,o._savedProviderOutputs=
null,s=o.lifetimeManager,o.valid=ko.computed(s,(function(){return o.steps().every((function(n){return n.isOptional||n.status()===3}))})),h=o._editScopeCache=new FxImpl.Data.EditScopeCacheOld({entityTypeName:e,supplyExistingData:function(n){return o._providerBase.initializeDataModel(n,(function(n){return o.overrideInputParameters(n)}))},serializeParams:function(){return"#"}}),n.registerForDispose(h),o._editScopeView=h.createView(s),o._providerBase=new u.ProviderBase(o._editScopeView),o.enableProvisioning=r(!1),o.provisionOnStartboardPart=r(!0),o.parameterCollectionErrors=r(),o.privateFcTpBI=new u.CollectorBindingInternals,o.privateFpTcBI=new u.ProviderBindingInternals,o.privatePcPrBI=new u.ProvisioningEntityBindingInternals,o._actionBarOutput=r(),o._baseProviderCommit=r(),o._baseWizardContainer=n,o._provisionerInstance=new u.Provisioner(o),o._savedProviderOutputs={},o.complete=function(){return},o._actionBarOutput.subscribe(s,(function(n){if(t.ActionBars.Base.isCompleted(n)){var i=o.getOutputsToCommit(
),r=function(){var n=o._editScopeCache;n.disposeAndDiscardEdits(o.editScopeId(),o._editScopeView)};o._providerBase.commitProvider({enableProvisioning:o.enableProvisioning(),provisioner:o._provisionerInstance,provisionerData:i,provisionerOptions:o._baseCollectorInputs.options,progressAction:function(n){o._baseWizardContainer.operations.add(n,{blockUi:!0})},discardEdits:r,privateFpTcBI:o.privateFpTcBI,privatePcPrBI:o.privatePcPrBI,provisionOnStartboardPart:o.provisionOnStartboardPart()})}})),o.parameterCollectionErrors.subscribe(s,(function(n){o.privateFcTpBI.errors(n)})),o}return __extends(s,f),Object.defineProperty(s.prototype,"dataModel",{get:function(){var n=this._editScopeView.editScope();return n&&n.root},enumerable:!0,configurable:!0}),s.prototype.onInputsSet=function(t){var v=this,a=null,f,e,s,o,h,i,c,l,r;if(this.cloudName(u.getCloudNameFromInputs(t)),this.editScopeId(t.editScopeId),this.provisionOnStartboardPart(t.provisionOnStartboardPart),this.privatePcPrBI.masterIsProvisioningPart(
t.masterIsProvisioningPart),f=t.privateFcTpBI,f&&(e=f.inputs,e&&(this._baseCollectorInputs=e,s=this._providerBase.onCollectorBindingsReceived(e,this.editScopeId(),(function(n){return v.onInputsReceived(n)})),this.enableProvisioning(s.enableProvisioning),a=s.promise),o=f.errors,o&&o.length>0)){this.onCommitError(o);this.onCommitError([])}return h=t.privateFpTcBI,t.privateFpTcBI&&(i=h.commit,!i||i===this._baseProviderCommit()||(i===y.format(this._baseProviderCommit())?(c=this._deferredProviderDismiss,c&&(c.resolve(),this._deferredProviderDismiss=undefined)):(this._baseProviderOutputs=h.outputs,this._baseProviderCommit(i)))),this.initialize(),l=t.stepOutput,l&&this.stepOutput(l),this.savedState()||this.savedState(t.savedState),r=t.output,r&&r.status&&!n.deepEquals(r,this._actionBarOutput())&&this._actionBarOutput(r),a},s.prototype.overrideInputParameters=function(n){return o.resolve(n)},s.prototype.getProviderInputs=function(){return e.getProviderInputs()},s.prototype.onProviderCommit=function(
){return e.onProviderCommit()},s.prototype.onInputsReceived=function(){return e.onInputsReceived()},s.prototype.getOutputsToCommit=function(){var n=i.Models.modelToParameters(this.dataModel);return{outputParameters:n}},s.prototype.onCommitError=function(){return e.onCommitError()},s.prototype.addWizardStep=function(n,t,i,r,u,f,e){this.insertWizardStep(null,n,t,i,r,u,f,e)},s.prototype.insertWizardStep=function(n,t,i,r,u,f,e,s){var h=this,l=new c.WizardStep(t,i,r,e,f,s);l.description(u);l.stepLoad=function(n){var t=o.Deferred();return h._providerBase.fetchEditScope(h.editScopeId(),h._baseCollectorInputs).then((function(){var i=h.getProviderInputs(n.stepId);n.stepId in h._savedProviderOutputs&&a.ProxiedObservables.data(i.options,"lastOutputParameters",h._savedProviderOutputs[n.stepId]);h.privateFcTpBI.inputs(i);t.resolve()})),t.promise()};l.stepComplete=function(n){var t=o.Deferred(),i=h.lifetimeManager.createChildLifetime();return h._baseProviderCommit.subscribe(i,(function(){h._savedProviderOutputs[
n.stepId]=h._baseProviderOutputs;h.onProviderCommit(n.stepId,h._baseProviderOutputs).then((function(n){n?h._baseProviderCommit().indexOf(p)>-1?(h._deferredProviderDismiss=t,h.privateFcTpBI.errors([{errorMessage:null,parameterName:h._baseProviderCommit()}]),h.privateFcTpBI.errors([])):t.resolve():t.reject()}));i.dispose()})),t.promise()};typeof n=="number"?this.steps.splice(n,0,l):this.steps.push(l)},s.prototype.removeWizardStep=function(n){this.steps.remove(n)},s.prototype.removeWizardStepAt=function(n){return this.steps.splice(n,1)[0]},s})(c.ViewModel);h=__decorate([n.Composition.ProxyCompatibilityMode],h);i.BaseWizardViewModel=h})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(n){var t;(function(n){"use strict";var i=(function(){function n(){this.inputParameters={};this.inputMetadata={};this.options={}}return n})(),t;n.ParameterCollectionInput=i;t=(function(){function n(){this.outputParameters=
{}}return n})();n.ParameterCollectionOutput=t})(t=n.ParameterCollectionV2||(n.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(n){var t;(function(n){"use strict";var t="parameterCollection",i="previousOutputParameters",r=ko.observable,u;(function(n){function u(n){var i={},t,r;for(t in n){t in i||(i[t]={});for(r in n[t])i[t][r]=n[t][r]()||""}return i}function f(n){var u={},t,i;for(t in n)for(i in n[t]){if(t in u||(u[t]={}),ko.isObservable(n[t][i])||ko.isComputed(n[t][i]))throw new Error("Parameters cannot be knockout observables.");u[t][i]?u[t][i](n[t][i]):u[t][i]=r(n[t][i])}return u}function e(n){return n&&t in n&&i in n[t]&&!!n[t][i]?n[t][i]:null}n.modelToParameters=u;n.parametersToModel=f;n.getPreviousOutputsFromOptions=e})(u=n.Utilities||(n.Utilities={}))})(t=n.ParameterCollectionV2||(n.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var
i;(function(i){"use strict";function s(n,t){return{stepId:"CommandStep",status:0,isFirstStep:!0,isLastStep:!0,isOptional:!1,disabled:!1,allowToggleProvisioningLocation:n,masterIsProvisioningPart:t}}var e=n.ViewModels,c=e.ActionBars,f=ko.observable,r="",o={unsetRole:r,setOnce:r,collectorMissing:r},u=FxImpl.getErrorMap(o),h=(function(n){function t(t,r){var u=n.call(this,t)||this;return u.stepInput=f(),u._collectorImpl=null,u._provisionerImpl=null,u._rolesSet=!1,u._baseCommandContainer=null,u._baseCommandInitialState=null,u.privateFcTpBI=new i.Internal.CollectorBindingInternals,u.privatePcPrBI=new i.Internal.ProvisionerBindingInternals,u._baseCommandContainer=t,u._baseCommandInitialState=r,u.enableProvisioning=f(!0),u.stepInput(s(!1,!0)),t.selectable.isSelected.subscribe(t,(function(n){n&&u._collectorImpl.sendInputsToProvider(null)})),u}return __extends(t,n),t.prototype.onInputsSet=function(n){var t=this,i=[];return this._rolesSet||u.unsetRole(),this._collectorImpl&&i.push(this._collectorImpl.
processInputs(n)),this._provisionerImpl&&i.push(this._provisionerImpl.processInputs(n)),Q.all(i).then((function(){t._provisionerImpl&&t.enableProvisioning(t._provisionerImpl.enableProvisioning())}))},t.prototype.initializeParameterCollectionRoles=function(n){this._rolesSet&&u.setOnce();this._extractCommandRoles(n,this._baseCommandContainer);this._rolesSet=!0},t.prototype._extractCommandRoles=function(n,t){var r=this,f=!!n&&n.parameterCollector,e=!!n&&n.provisioner,o;f||u.collectorMissing();o={commitWhenSignaled:!0,commitAction:function(){if(r._provisionerImpl){var n=function(){var n=r.privateFcTpBI.inputs();r._provisionerImpl.executeProvisioning(r._collectorImpl.providerOutputs,n&&n.options)},i={privateFcTpBI:{inputs:r.privateFcTpBI.inputs()}},t=r._provisionerImpl.processInputs(i);t?t.then(n):n()}r._baseCommandContainer.selectable.isSelected(!1)}};this._collectorImpl=i.Internal.ParameterCollectorFactory.createParameterCollector(f,{},this.privateFcTpBI,t,o);e&&(this._provisionerImpl=i.Internal.
ProvisionerFactory.createProvisioner(e,this.privatePcPrBI))},t})(t.OpenBladeCommand);i.Command=h})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";var f=n.ViewModels,a=f.ActionBars.Base,p=f.ParameterCollection.Internal,v=HubsExtension.Azure.Pricing,e=n.deepEquals,u=ko.observable,w=ko.observableArray,y=ko.computed,o=v.Constants.LegalTermsBlade,s=v.Constants.PricingSummaryBlade,r=null,b=n.forEachKey,h="",k={setOnce:h,rejected:h,multipleSelectors:h},c=FxImpl.getErrorMap(k),l=(function(n){function h(h,c){var l=n.call(this,h)||this,p,b,k,v;return l.editScopeId=u(),l.actionInProgress=u(!1),l.enableProvisioning=u(!1),l.eula=u(""),l.secondaryLinkDisplayText=u(""),l.galleryPricingInfo=u(),l.cloudName=u(),l._collectorImpl=r,l._providerImpl=r,l._provisionerImpl=r,l._parameterCollectionRolesSet=!1,l._actionBarOutput=r,l._actionInProgressLock=!1,l._baseFormInitialState=
r,l._hotSpotItems=w(),l._initialSelectedValue=r,l._previousOutput=r,l._selectableMap={},l._isValid=u(!1),l._galleryItem=u(r),p=c&&c.content&&c.content.selectable,b=c&&c.content&&c.content.secondaryLinkSelectable,l._editScopeImpl||(l._editScopeImpl=r),l.privateFcTpBI=new i.Internal.CollectorBindingInternals,l.privateFpTcBI=new i.Internal.ProviderBindingInternals,l.privatePcPrBI=new i.Internal.ProvisionerBindingInternals,l._baseFormInitialState=c,l._initialSelectedValue=p&&p.selectedValue,l._actionBarOutput=u(),l.stepInput=u(),l.stepOutput=u(),k=l.valid,v=l._ltm,l.valid=y(v,(function(){return l._isValid()&&k()})),l.selectable=new t.Selectable({allowUnselect:!1,selectedValue:l._initialSelectedValue,isSelected:p&&p.isSelected,isActivated:p&&p.isActivated}),v.registerForDispose(l.selectable),l.secondaryLinkSelectable=new t.Selectable({allowUnselect:!1,selectedValue:b&&b.selectedValue,isSelected:b&&b.isSelected,isActivated:b&&b.isActivated}),v.registerForDispose(l.secondaryLinkSelectable),l.hotSpot=
new t.SelectableSet(l._hotSpotItems,function(n,t){return n.selectedValue()===t},function(n){return n.selectedValue()},c&&c.content&&c.content.hotSpot),v.registerForDispose(l.hotSpot),l._actionBarOutput.subscribe(v,(function(n){var i,r,t;a.isCompleted(n)&&(i=function(){l.actionInProgress(!0);l._providerImpl.getOutputsToCommit().then((function(n){l._providerImpl.commitOutputs({provisioner:l._provisionerImpl,provisionerData:n,progressAction:function(n){h.operations.add(n,{blockUi:!0})},discardEdits:function(){return l._editScopeImpl.discardEditScopeEdits()},privateFpTcBI:l.privateFpTcBI,privatePcPrBI:l.privatePcPrBI})}))},n.actionButtonClicked&&l.secondaryLinkSelectable.isSelected()?l.secondaryLinkSelectable.selectedValue().detailBlade===o.bladeName?(l._actionInProgressLock=!0,l.secondaryLinkSelectable.isSelected(!1),i()):l.secondaryLinkSelectable.isSelected(!1):(r=l.galleryPricingInfo(),t=l._galleryItem(),l.enableProvisioning()&&r&&t&&(t.products.length>0||t.productsWithNoPricing.length>0)?
(l.secondaryLinkSelectable.selectedValue(f.getBladeSelection(o.bladeExtension,o.bladeName,{galleryPricingInfo:r,galleryItem:t})),l.actionInProgress(!0),l.secondaryLinkSelectable.isSelected(!0)):i()))})),l.selectable.isSelected.subscribe(v,(function(n){n||l._unselectFields()})),l.secondaryLinkSelectable.isSelected.subscribe(v,(function(n){n||l._actionInProgressLock||l.actionInProgress(!1)})),l.stepOutput.subscribe(v,(function(n){var t=l._previousOutput;l._previousOutput=n;!e(t,n)&&a.isCompleted(n)&&l._onSelectorComplete(n.stepId).then((function(){l.selectable.isSelected(!1)}))})),y(v,(function(){l.galleryPricingInfo()&&l._galleryItem()?l.secondaryLinkDisplayText(s.displayText):l.secondaryLinkDisplayText(r)})),l}return __extends(h,n),h.prototype.initializeParameterCollectionRoles=function(n){this._parameterCollectionRolesSet&&c.setOnce();this._extractFormRoles(n,this._ltm);this._parameterCollectionRolesSet=!0},Object.defineProperty(h.prototype,"dataModel",{get:function(){var n=this._editScopeImpl;return n&&
n.dataModel||r},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"inputMetadata",{get:function(){var n=this._editScopeImpl,t=n&&n.collectorInputs,i=t&&t.inputMetadata;return i||r},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"parameterCollectionOptions",{get:function(){var n=this._editScopeImpl,t=n&&n.collectorInputs,i=t&&t.options;return i||r},enumerable:!0,configurable:!0}),h.prototype.onFormInputsSet=function(){return r},h.prototype.onInputsSet=function(n){var t=this,i=[],y,l,a,o,v,h;this.cloudName(p.getCloudNameFromInputs(n));this.editScopeId(n.editScopeId);var u=this._editScopeImpl,w=u&&u.collectorInputs,b=w&&w.inputParameters;b&&(y=b);u&&i.push(u.processInputs(n));l=this._collectorImpl;l&&i.push(l.processInputs(n));a=this._providerImpl;a&&i.push(a.processInputs(n));o=this._provisionerImpl;o&&i.push(o.processInputs(n));v=n.stepOutput;v&&this.stepOutput(v);var k=n.privateFcTpBI,d=k&&k.inputs,g=d&&d.options,nt=g&&g.galleryOptions;return this._galleryItem(
nt&&nt.galleryItem||r),n.output&&(h=n.output&&n.output.secondaryLinkClicked,!h||h!==this.secondaryLinkDisplayText()||this._previousSecondaryLinkCommitId===n.output.commitId||(this._previousSecondaryLinkCommitId=n.output.commitId,this.actionInProgress(!1),this.secondaryLinkSelectable.selectedValue(f.getBladeSelection(s.bladeExtension,s.bladeName,{galleryPricingInfo:this.galleryPricingInfo(),galleryItem:this._galleryItem()})),this.secondaryLinkSelectable.isSelected(!0)),!n.output.status||h||e(n.output,this._actionBarOutput())||this._actionBarOutput(n.output)),Q.all(i).then((function(){if(o&&t.enableProvisioning(o.enableProvisioning()),!e(y,u.collectorInputs.inputParameters)){var n=t.onFormInputsSet(t._ltm,t._baseFormInitialState);if(n)return n.then((function(){t._isValid(!0)}),(function(){c.rejected()}));t._isValid(!0)}}))},h.prototype.dispose=function(){n.prototype.dispose.call(this)},h.prototype.registerHotSpot=function(n){var t=n.selectable||n,i;this._hotSpotItems.push(t);i=this.hotSpot.selectableItems(
).first((function(n){return n.data===t}));ko.utils.twoWayBinding(this._ltm,t.isSelected,i.isActivated)},h.prototype.registerSelector=function(n,t,i){i&&this._collectorImpl&&this._collectorImpl.addProvider(n,i);this._registerSelectable(n,t.selectable)},h.prototype.registerInfoBox=function(n,t,i){i&&this._collectorImpl&&this._collectorImpl.addProvider(n,i);this._registerSelectable(n,t.selectable)},h.prototype._registerSelectable=function(n,t){var i=this,r;this._selectableMap[n]&&c.multipleSelectors();this._selectableMap[n]=t;r=this._initialSelectedValue;r!==undefined&&e(r,t.selectedValue())&&t.isSelected(this.selectable.isSelected());t.isSelected.subscribe(this._ltm,(function(r){r&&(i._unselectFields(t),i.selectable.selectedValue(t.selectedValue()),i.stepInput({stepId:n,status:0,isLastStep:!1}),i.selectable.isSelected(!0),i._onSelectorLoad(n))}))},h.prototype._extractFormRoles=function(n,t){var e=!!n&&n.parameterCollector,u=!!n&&n.parameterProvider,f=!!n&&n.provisioner,r=this._editScopeImpl;
r||(r=this._editScopeImpl=i.Internal.EditScopeFactory.createEditScope(u,t));this.editScope=this._editScopeImpl.editScope;this._providerImpl=i.Internal.ParameterProviderFactory.createParameterProvider(u,r);this._collectorImpl=i.Internal.ParameterCollectorFactory.createParameterCollector(e,r,this.privateFcTpBI,t);f&&(this._provisionerImpl=i.Internal.ProvisionerFactory.createProvisioner(f,this.privatePcPrBI))},h.prototype._unselectFields=function(n){b(this._selectableMap,(function(t,i){n&&n===i||i.isSelected(!1)}))},h.prototype._onSelectorLoad=function(n){var t=this;return this._editScopeImpl.fetchEditScope().then((function(){var i=t._collectorImpl;i&&i.sendInputsToProvider(n)}))},h.prototype._onSelectorComplete=function(n){var t=this._collectorImpl;return t?t.commitProviderOutputs(n):Q()},h})(t.Forms.Form.ViewModel);l=__decorate([n.Composition.ProxyCompatibilityMode],l);i.Form=l})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx=
{})),(function(n){var t;(function(t){var i;(function(i){"use strict";var o=n.ViewModels,e=o.Controls,s=e.Lists.Grid,r=ko.observable,l=ko.observableArray,h=n.deepEquals,c=n.getUniqueId,a=i.Internal.ParameterProviderFactory,v=window,f=" is not implemented",u=(function(n){function u(u,f,e,o){var h,c,p,w,y,v;o===void 0&&(o=!1);h=n.call(this,u)||this;h.editScopeId=r();h.eula=r("");h.listHeader=r();h.listSubHeader=r();h.multiselectEnabled=r(!1);h.showCreateAction=r(!1);h.triggerSelectAction=r("");h.valid=r(!1);h.isCreateActionResult=r(!1);h.pickerActivationBladeOpener=r();h.createActionBladeOpener=r();h.itemSelectedByDefault=r();h.filterItems=r();h.filters=l();h._filteredItems=[];h._createSelectorField=null;h._selectorOriginalValue=r();h._selectorEditableValue=r();h._createSelectorBladeName=null;h._createSelectorBladeExtension=null;h._throttleUnselectSelectorFieldHandle=null;h._collectorImpl=null;h._providerImpl=null;h._parameterCollectionRolesSet=!1;h._basePickerInitialState=null;h._actionBarOutput=
null;c=h.lifetimeManager;h.controlType=80;h._editScopeImpl||(h._editScopeImpl=null);h.privateFcTpBI=new i.Internal.CollectorBindingInternals;h.privateFpTcBI=new i.Internal.ProviderBindingInternals;h.multiselectEnabled(o);h._basePickerInitialState=f;p=h._actionBarOutput=r();w=h.createActionSelectorField=r();h.isCreateActionResult(!1);h.stepInput=r();var b=s.Extensions.SelectableRow,k=h._getGridExtensionOptions(),a=h.itemsGridViewModel=new s.ViewModel(c,e,b,k);return a.showHeader=!0,a.columns=h.getColumns(),h._initializeCreateActionSelector(c),p.subscribe(c,(function(n){if(t.ActionBars.Base.isCompleted(n)){var i=h._providerImpl;i.getOutputsToCommit().then((function(n){i.commitOutputs({provisioner:null,provisionerData:n,progressAction:function(n){u.operations.add(n,{blockUi:!0})},discardEdits:function(){return h._editScopeImpl.discardEditScopeEdits()},privateFpTcBI:h.privateFpTcBI,privatePcPrBI:null})}))}})),y=function(n){var t=h.getMatchingItemIndex(n);h._selectGridItem(t)},h.itemSelectedByDefault.
subscribe(c,(function(n){h.multiselectEnabled()?n.forEach(y):n&&y(n)})),h.filters.subscribeAndRun(c,(function(){h._filterGridItems(h.filterItems())})),h.filterItems.subscribe(c,(function(n){h._filterGridItems(n)})),a.items.subscribe(c,(function(n){h._filterGridItems(h.filterItems());h._runFilters(n)})),v=a.selectableData.selectedItems,v.subscribe(c,(function(n){h._onSelectedItemsChanged(n)})),h.createActionBladeOpener.subscribe(c,(function(n){n?(h._clearThrottleUnselectSelectorFieldHandle(),v([]),w().selectable.isSelected(!0)):h._closeBlade(v())})),h}return __extends(u,n),u.prototype.initializeCreateSelector=function(n,t,i,r,u,f){this._selectorOriginalValue(n);this._selectorEditableValue(n);this._createSelectorField.label(t);this._createSelectorBladeName=i;this._createSelectorBladeExtension=r;u&&this._collectorImpl&&this._collectorImpl.addProvider(t,u);f&&ko.utils.arrayPushAll(this._createSelectorField.validations,f)},u.prototype.onPickerInputsSet=function(){return null},u.prototype.onInputsSet=function(
n){var f=this,i=[],e,t,r,u;return this.editScopeId(n.editScopeId),t=this._editScopeImpl,t&&(r=t.collectorInputs,r&&r.inputParameters&&(e=r.inputParameters),i.push(t.processInputs(n))),this._collectorImpl&&i.push(this._collectorImpl.processInputs(n)),this._providerImpl&&i.push(this._providerImpl.processInputs(n)),this.stepInput(n.stepInput),u=n.output||{},u.status&&!h(u,this._actionBarOutput())&&this._actionBarOutput(u),Q.all(i).then((function(){if(!h(e,t.collectorInputs.inputParameters))return Q(f.onPickerInputsSet(f.lifetimeManager,f._basePickerInitialState))}))},u.prototype.initializeParameterCollectionRoles=function(n){if(this._parameterCollectionRolesSet)throw new Error("The 'parameterCollectionRoles' property should be only set once.");this._extractPickerRoles(n,this.lifetimeManager);this._parameterCollectionRolesSet=!0},Object.defineProperty(u.prototype,"dataModel",{get:function(){return this._editScopeImpl?this._editScopeImpl.dataModel:null},enumerable:!0,configurable:!0}),Object.
defineProperty(u.prototype,"inputMetadata",{get:function(){var n=this._editScopeImpl,t=n&&n.collectorInputs;return t&&t.inputMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"parameterCollectionOptions",{get:function(){var n=this._editScopeImpl,t=n&&n.collectorInputs;return t&&t.options},enumerable:!0,configurable:!0}),u.prototype.getParameter=function(n,t,i){return t in i&&n in i[t]?i[t][n]:null},u.prototype.dispose=function(){this._clearThrottleUnselectSelectorFieldHandle();n.prototype.dispose.call(this)},u.prototype.getMatchingItemIndex=function(){throw new Error("'getMatchingItemIndex'"+f);},u.prototype.getColumns=function(){throw new Error("'getColumns'"+f);},u.prototype.itemMatchesSelection=function(){throw new Error("'itemMatchesSelection'"+f);},u.prototype.createSelection=function(){throw new Error("'createSelection'"+f);},u.prototype._extractPickerRoles=function(n,t){var r=this,u=!!n&&n.parameterCollector,f=!!n&&n.parameterProvider,e;this._editScopeImpl||
(this._editScopeImpl=i.Internal.EditScopeFactory.createEditScope(f,t,(function(){return r.onPickerInputsSet(r.lifetimeManager,r._basePickerInitialState)})));this._editScopeImpl.initializeEditScope();e={commitWhenSignaled:!0,commitAction:function(){r.isCreateActionResult(!0);r.createActionSelectorField().selectable.isSelected(!1);r.itemsGridViewModel.selectableData.selectedItems([]);r.valid(!0);r.triggerSelectAction(c())}};this._providerImpl=a.createParameterProvider(f,this._editScopeImpl);u&&(this._collectorImpl=i.Internal.ParameterCollectorFactory.createParameterCollector(u,this._editScopeImpl,this.privateFcTpBI,t,e))},u.prototype._onSelectedItemsChanged=function(n){var t=n&&n.length>0,i;if(t){if(this.isCreateActionResult(!1),i=this._runFilters(n),i){this.valid(!1);return}this._closeBlade(n)}this.valid(t)},u.prototype._runFilters=function(n){var t=this,i,r,u;if(n&&n.length){var f=!1,e=this.filters,o=e&&e();return o&&(i=[],r=[],o.forEach((function(u){u.getDisabledItems(n).then((function(n)
{n.forEach((function(n){var u=t.itemsGridViewModel.items().first((function(i){return t.itemMatchesSelection(n.item,i)}));u&&(t._disableGridItem(u,n.disabledReason),r.push(u),f=!0,i.push(n))}))}))})),u=this._filteredItems,u.push.apply(u,i),this.itemsGridViewModel.selectableData.selectedItems.removeAll(r)),f}return!1},u.prototype._closeBlade=function(n){var r=this,t,i;this._clearThrottleUnselectSelectorFieldHandle();this._throttleUnselectSelectorFieldHandle=setTimeout((function(){var n=r.createActionSelectorField();n&&n.selectable.isSelected(!1)}),0);this.multiselectEnabled()||n.length!==1||(t=this.itemSelectedByDefault(),i=t&&this.itemMatchesSelection(this.itemsGridViewModel.items()[this.getMatchingItemIndex(t)],n[0]),i||this.triggerSelectAction(c()))},u.prototype._clearThrottleUnselectSelectorFieldHandle=function(){var n=this._throttleUnselectSelectorFieldHandle;n&&(v.clearTimeout(n),this._throttleUnselectSelectorFieldHandle=null)},u.prototype._getGridExtensionOptions=function(){return{selectableRow:
{selectionMode:this.multiselectEnabled()?2:1,itemMatchesSelection:this.itemMatchesSelection,createSelection:this.createSelection}}},u.prototype._selectGridItem=function(n){if(n!==-1){var t=this.itemsGridViewModel,i=t.getRowMetadata(t.items()[n]);i.selected(!0)}},u.prototype._disableGridItem=function(n,t){var i,r;n&&(i=this.itemsGridViewModel.getRowMetadata(n),i.disabled(!0),t&&n.hasOwnProperty("infoBalloon")&&(r=n.infoBalloon||(n.infoBalloon=new e.DockedBalloon.ViewModel(this.lifetimeManager)),r.content(t)))},u.prototype._initializeCreateActionSelector=function(n){var i=this,t=this._createSelectorField=new o.Forms.Selector.ViewModel(n,{defaultValue:this._selectorOriginalValue});t.value=this._selectorEditableValue;this.createActionSelectorField(t);t.selectable.isSelected.subscribe(n,(function(n){n?i._launchCreateActionBlade():i.createActionBladeOpener(undefined)}))},u.prototype._launchCreateActionBlade=function(){this._collectorImpl.sendInputsToProvider(null);this.itemsGridViewModel.selectableData.
selectedItems([]);this.createActionBladeOpener({detailBlade:this._createSelectorBladeName,extension:this._createSelectorBladeExtension,detailBladeInputs:{}})},u.prototype._filterGridItems=function(n){var t=this,r=this.itemsGridViewModel.items,i;n&&n.forEach((function(n){var i=t.getMatchingItemIndex(n.id);i!==-1&&t._disableGridItem(r()[i],n.reason)}));i=this._filteredItems;i&&i.forEach((function(n){var i=r().first((function(i){return t.itemMatchesSelection(n.item,i)}));i&&t._disableGridItem(i,n.disabledReason)}))},u})(e.Loadable.ViewModel);u.filterPickerItemsParameterName="filterPickerItems";u.pickerItemsParameterName="pickerItems";u=__decorate([n.Composition.ProxyCompatibilityMode],u);i.Picker=u})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(t){"use strict";var i=n.Base,r=n.Resources.Strings.Pickers.AccessDenied,u=(function(){function n(n,t){this._requiredPermission=t;this.
_mapItemToResourceId=n}return n.prototype.getDisabledItems=function(n){var t=this,u=[],f=[],e=Q.defer();return n.forEach((function(n){f.push(i.Security.hasPermission(t._mapItemToResourceId(n),[t._requiredPermission]).then((function(t){t||u.push({item:n,disabledReason:r.reasonMessage})})))})),Q.allSettled(f).then((function(){return e.resolve(u)})),e.promise},n})();t.ArmRbacFilter=u})(i=t.PickerFilter||(t.PickerFilter={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";var h=n.ViewModels.ParameterCollection.Internal,u=ko.observable,e=n.deepEquals,r=null,o="",c={missingRoles:o,setOnce:o},s=FxImpl.getErrorMap(c),f=(function(n){function f(f,e){var o=n.call(this,f,e&&e.content)||this,s;return o.editScopeId=u(),o.enableProvisioning=u(!1),o.eula=u(""),o.provisionOnStartboardPart=u(!0),o.cloudName=u(),o._collectorImpl=r,o._providerImpl=r,o._provisionerImpl=r,o._parameterCollectionRolesSet=!1,o._actionBarOutput=r,o._baseWizardContainer=
r,o._baseWizardInitialState=r,s=o.lifetimeManager,o._editScopeImpl||(o._editScopeImpl=r),o.privateFcTpBI=new i.Internal.CollectorBindingInternals,o.privateFpTcBI=new i.Internal.ProviderBindingInternals,o.privatePcPrBI=new i.Internal.ProvisionerBindingInternals,o._baseWizardContainer=f,o._baseWizardInitialState=e,o.complete=function(){return},o.valid=ko.computed(s,(function(){return o.steps().every((function(n){return n.isOptional||n.status()===3}))})),o._actionBarOutput=u(),o._actionBarOutput.subscribe(s,(function(n){t.ActionBars.Base.isCompleted(n)&&o._providerImpl.getOutputsToCommit().then((function(n){o._providerImpl.commitOutputs({provisioner:o._provisionerImpl,provisionerData:n,progressAction:function(n){o._baseWizardContainer.operations.add(n,{blockUi:!0})},discardEdits:function(){return o._editScopeImpl.discardEditScopeEdits()},privateFpTcBI:o.privateFpTcBI,privatePcPrBI:o.privatePcPrBI})}))})),o}return __extends(f,n),f.prototype.onWizardInputsSet=function(){return},f.prototype.onInputsSet=
function(n){var t=this,i=[],f,u,r;return this.cloudName(h.getCloudNameFromInputs(n)),this._parameterCollectionRolesSet||s.missingRoles(),this.editScopeId(n.editScopeId),u=this._editScopeImpl&&this._editScopeImpl.collectorInputs||{},u.inputParameters&&(f=u.inputParameters),this._editScopeImpl&&i.push(this._editScopeImpl.processInputs(n)),this._collectorImpl&&i.push(this._collectorImpl.processInputs(n)),this._providerImpl&&i.push(this._providerImpl.processInputs(n)),this._provisionerImpl&&i.push(this._provisionerImpl.processInputs(n)),n.stepOutput&&this.stepOutput(n.stepOutput),this.savedState()||this.savedState(n.savedState),r=n.output||{},r.status&&!e(r,this._actionBarOutput())&&this._actionBarOutput(r),Q.all(i).then((function(){t._provisionerImpl&&t.enableProvisioning(t._provisionerImpl.enableProvisioning());var n;return e(f,t._editScopeImpl.collectorInputs.inputParameters)||(n=Q(t.onWizardInputsSet(t._baseWizardContainer,t._baseWizardInitialState))),t.initialize(),Q(n)}))},f.prototype.
initializeParameterCollectionRoles=function(n){this._parameterCollectionRolesSet&&s.setOnce();this._extractWizardRoles(n,this._baseWizardContainer);this._parameterCollectionRolesSet=!0},Object.defineProperty(f.prototype,"dataModel",{get:function(){if(this._editScopeImpl)return this._editScopeImpl.dataModel},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"inputMetadata",{get:function(){var n=this._editScopeImpl&&this._editScopeImpl.collectorInputs||{};return n.inputMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"parameterCollectionOptions",{get:function(){var n=this._editScopeImpl&&this._editScopeImpl.collectorInputs||{};return n.options},enumerable:!0,configurable:!0}),f.prototype.addWizardStep=function(n,t,i,u,f,e,o,s){this.insertWizardStep(r,n,t,i,u,f,e,o,s)},f.prototype.insertWizardStep=function(n,i,r,u,f,e,o,s,h){var c=this,l=new t.Controls.Wizard.WizardStep(i,r,u,s,o,h);l.description(f);l.stepLoad=function(n){return c._editScopeImpl.
fetchEditScope().then((function(){c._collectorImpl&&c._collectorImpl.sendInputsToProvider(n.stepId)}))};l.stepComplete=function(n){return c._collectorImpl?c._collectorImpl.commitProviderOutputs(n.stepId):Q()};typeof n=="number"?this.steps.splice(n,0,l):this.steps.push(l);e&&this._collectorImpl&&this._collectorImpl.addProvider(i,e)},f.prototype.removeWizardStep=function(n){this._collectorImpl&&this._collectorImpl.removeProvider(n.stepId);this.steps.remove(n)},f.prototype.removeWizardStepAt=function(n){return this._collectorImpl&&this._collectorImpl.removeProvider(this.steps()[n].stepId),this.steps.splice(n,1)[0]},f.prototype._extractWizardRoles=function(n,t){var f=!!n&&n.parameterCollector,r=!!n&&n.parameterProvider,u=!!n&&n.provisioner;this._editScopeImpl||(this._editScopeImpl=i.Internal.EditScopeFactory.createEditScope(r,t));this._editScopeImpl.initializeEditScope();this._collectorImpl=i.Internal.ParameterCollectorFactory.createParameterCollector(f,this._editScopeImpl,this.privateFcTpBI,
t);this._providerImpl=i.Internal.ParameterProviderFactory.createParameterProvider(r,this._editScopeImpl);u&&(this._provisionerImpl=i.Internal.ProvisionerFactory.createProvisioner(u,this.privatePcPrBI))},f})(t.Controls.Wizard.ViewModel);f=__decorate([n.Composition.ProxyCompatibilityMode],f);i.Wizard=f})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={}))